{"version":3,"sources":["component/VisualTools/Chart/KMCurve.js"],"names":["isUndefined","d","undefined","toLowerCase","KMCurve","props","self","React","createRef","maxTime","Number","NEGATIVE_INFINITY","state","margin","top","right","bottom","left","loading","error","filter","data","transform","field","value","fields","event_value","eventValue","censored_value","censoredValue","group","time","event","collapsed_stage","Math","max","map","groups","d3","nest","key","entries","rs","forEach","g","risk","values","length","sortKeys","a","b","rollup","v","censor","p","points","e","c","censored","push","viewer","color","line","curve","curveStepAfter","x","xScale","y","yScale","append","datum","attr","style","point","drawLine","setTimeout","rect","current","getBoundingClientRect","innerWidth","width","innerHeight","height","svg","select","scaleLinear","domain","range","scaleOrdinal","quantize","t","interpolateSpectral","xaxisGroup","call","axisBottom","ticks","text","unit","yaxisGroup","axisLeft","drawKMCurve","nodeWidth","getBBox","legend","lg","selectAll","enter","i","offset","id","PureComponent"],"mappings":"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","file":"KMCurve.39d81891.js","sourceRoot":"../source","sourcesContent":["import React, { PureComponent } from 'react'\nimport {isEquivalent} from '../../../common/utils.js'\nimport * as d3 from \"d3\";\n\nfunction isUndefined(d){\n    return d==undefined||d==null||(typeof d === 'string' && d.toLowerCase()==`na`)\n}\nexport default class KMCurve extends PureComponent {\n    constructor(props) {\n        super(props);\n        this.self = React.createRef();\n        this.maxTime = Number.NEGATIVE_INFINITY;\n        this.state = {\n            margin: {top: 35, right: 20, bottom: 45, left: 45},\n            loading:true,\n            error:null\n        }\n        if(this.props.filter) {\n            this.state.data = this.transform(this.props.data.filter(d=>d[this.props.filter.field]==this.props.filter.value), this.props.fields);\n        }else{\n            this.state.data = this.transform(this.props.data, this.props.fields);\n        }\n    }\n    transform(data,field){\n        const event_value = field.eventValue;\n        const censored_value = field.censoredValue;\n        const group =  field.group.field;\n        const time = field.time.field;\n        const event = field.event.field;\n        \n        \n        data = data.filter(d=>d.collapsed_stage!='stage_x/NR'&&!isUndefined(d[time])&&!isUndefined(d[event])&&!isUndefined(d[group]))\n        this.maxTime = Math.max(...data.map(d=>d[time]));\n        const groups = d3.nest().key(d=>d[group]).entries(data)\n        const rs = []\n        groups.forEach(g=>{\n            const key = g.key;\n            let risk = g.values.length;\n            const values = d3.nest()\n            .key(d=> +d[time])\n            .sortKeys((a,b)=>(+a)-(+b))\n            .rollup(function(v) {\n                return {\n                    event:v.filter(d=>d[event]==event_value).length,\n                    censor:v.filter(d=>d[event]==censored_value).length\n                };\n            })\n            .entries(g.values);\n            let p = 1;\n            const points = [];\n            values.forEach(d=>{\n                const time = +d.key;\n                const e = d.value.event;\n                const c = d.value.censor;\n                if(time<0) return;\n                if(e > 0){\n                    p *= (1 - e/risk)\n                    const censored = false;\n                    points.push({p, time, censored})\n                }\n                if(c > 0){\n                    const censored = true;\n                    points.push({p, time, censored})\n                }\n                risk -= (e + c);\n            })\n            rs.push({key,points})\n            \n        })\n        \n        return rs;\n        \n    }\n    \n    drawLine(viewer, points, color){\n        const line = d3.line()\n        .curve(d3.curveStepAfter)\n        .x(d=> this.xScale(d.time))\n        .y(d=> this.yScale(d.p));       \n        viewer.append(\"path\")\n            .datum(points)\n            .attr(\"class\", \"line\")\n            .style(\"stroke\", color)\n            .attr(\"d\", line);\n        \n        \n        points.forEach(point=>{\n            if(point.censored){\n                const p = [{\n                    p:point.p-0.015,\n                    time:point.time,\n                },{\n                    p:point.p+0.015,\n                    time:point.time,\n                }] \n                viewer.append(\"path\")\n                .datum(p)\n                .attr(\"class\", \"mark\")\n                .style(\"stroke\", color)\n                .attr(\"d\", line);\n            }\n        })\n        \n        \n    }\n\n    drawCensoredMark(viewer , point, color){\n\n    }\n\n    drawKMCurve(viewer, d) {\n        \n        // draw lines\n        this.drawLine(viewer, d.points, this.color(d.key))\n        // draw marks\n    }\n\n    componentDidUpdate() {\n\n    }\n    \n    componentDidMount() {\n        setTimeout(()=>{\n            const rect = this.self.current.getBoundingClientRect();\n            const innerWidth = rect.width - this.state.margin.left - this.state.margin.right;\n            const innerHeight = rect.height - this.state.margin.top - this.state.margin.bottom;\n            // create svg \n            const svg = d3.select(this.self.current)\n            .append(\"svg\")\n                .attr(\"width\", rect.width)\n                .attr(\"height\", rect.height)\n            // create viewer\n            const viewer = svg.append(\"g\")\n                .attr(\"transform\", \"translate(\" + this.state.margin.left + \",\" + this.state.margin.top + \")\");\n            //\n            this.xScale = d3.scaleLinear()\n            .domain([0, this.maxTime])\n            .range([0, innerWidth])\n            \n            this.yScale = d3.scaleLinear()\n            .domain([0, 1])\n            .range([innerHeight, 0])\n    \n            this.color = d3.scaleOrdinal()\n            .domain(this.state.data.map(d => d.key))\n            .range(d3.quantize(t => d3.interpolateSpectral(t), this.state.data.length))\n            \n            \n    \n    \n            const xaxisGroup = viewer.append(\"g\")\n            .attr(\"transform\", \"translate(0,\" + innerHeight + \")\")\n            .call(d3.axisBottom(this.xScale).ticks(4)); //.tickSize(-innerWidth));\n            xaxisGroup.append('text')\n            .attr('y', 30)\n            .attr('x', innerWidth/2)\n            .attr('fill','black')\n            .attr('font-size',13)\n            .text(`Time ${this.props.fields.time.unit?`(${this.props.fields.time.unit})`:''}`)\n            \n            // add the y Axis\n            const yaxisGroup = viewer.append(\"g\")\n                .call(d3.axisLeft(this.yScale).ticks(4)); // .tickSize(-innerWidth)\n                yaxisGroup.append('text')\n                .attr('y', -30)\n                .attr('x', -innerHeight/3)\n                .attr('fill','black')\n                .attr('font-size',13)\n                .attr(\"transform\", \"rotate(-90)\")\n                .text(`Survival Probability`)\n    \n            this.state.data.forEach(d=>this.drawKMCurve(viewer,d))\n    \n    \n            const height = 0;\n            const width = 15;\n            var nodeWidth = (d) => d.getBBox().width;\n            const legend = svg.append('g')\n              .attr('class', 'legend')\n              .attr('transform', `translate(${this.state.margin.left+innerWidth/2},0)`);\n    \n            const lg = legend.selectAll('g')\n              .data(this.state.data)\n              .enter()\n            .append('g')\n              .attr('transform', (d,i) => `translate(${i * 100},${height + 15})`);\n    \n            lg.append('rect')\n              .style('fill', d => this.color(d.key))\n              .attr('x', 0)\n              .attr('y', 0)\n              .attr('width', 10)\n              .attr('height', 10);\n    \n            lg.append('text')\n              .style('font-family', 'Georgia')\n              .style('font-size', '13px')\n              .attr('x', 17.5)\n              .attr('y', 10)\n              .text(d => d.key);\n    \n            let offset = 0;\n            lg.attr('transform', function(d, i) {\n                let x = offset;\n                offset += nodeWidth(this) + 10;\n                return `translate(${x},${height + 10})`;\n            }); \n        },500);\n       \n    }\n    \n    render() {\n        return (\n            <div\n              id={this.props.id}\n              ref={this.self}\n              style={{ width: \"100%\", height: \"100%\" }}\n            ></div>\n        );\n    }\n}\n"]}