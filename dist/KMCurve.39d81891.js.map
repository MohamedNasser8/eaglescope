{"version":3,"sources":["component/VisualTools/Chart/KMCurve.js"],"names":["isUndefined","d","undefined","toLowerCase","KMCurve","props","self","React","createRef","maxTime","Number","NEGATIVE_INFINITY","state","margin","top","right","bottom","left","loading","error","filter","data","transform","field","value","fields","event_value","eventValue","censored_value","censoredValue","group","time","event","collapsed_stage","Math","max","map","groups","d3","nest","key","entries","rs","forEach","g","risk","values","length","sortKeys","a","b","rollup","v","censor","p","points","e","c","censored","push","viewer","color","line","curve","curveStepAfter","x","xScale","y","yScale","append","datum","attr","style","point","drawLine","setTimeout","rect","current","getBoundingClientRect","innerWidth","width","innerHeight","height","svg","select","scaleLinear","domain","range","scaleOrdinal","quantize","t","interpolateSpectral","xaxisGroup","call","axisBottom","ticks","text","unit","yaxisGroup","axisLeft","drawKMCurve","nodeWidth","getBBox","legend","lg","selectAll","enter","i","offset","id","PureComponent"],"mappings":"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","file":"KMCurve.39d81891.js","sourceRoot":"../source","sourcesContent":["import React, { PureComponent } from 'react'\nimport {isEquivalent} from '../../../common/utils.js'\nimport * as d3 from \"d3\";\n\nfunction isUndefined(d){\n    return d==undefined||d==null||(typeof d === 'string' && d.toLowerCase()==`na`)\n}\nexport default class KMCurve extends PureComponent {\n    constructor(props) {\n        super(props);\n        this.self = React.createRef();\n        this.maxTime = Number.NEGATIVE_INFINITY;\n        this.state = {\n            margin: {top: 35, right: 20, bottom: 45, left: 45},\n            loading:true,\n            error:null\n        }\n        if(this.props.filter) {\n            this.state.data = this.transform(this.props.data.filter(d=>d[this.props.filter.field]==this.props.filter.value), this.props.fields);\n        }else{\n            this.state.data = this.transform(this.props.data, this.props.fields);\n        }\n    }\n    transform(data,field){\n        const event_value = field.eventValue;\n        const censored_value = field.censoredValue;\n        const group =  field.group.field;\n        const time = field.time.field;\n        const event = field.event.field;\n        \n        \n        data = data.filter(d=>d.collapsed_stage!='stage_x/NR'&&!isUndefined(d[time])&&!isUndefined(d[event])&&!isUndefined(d[group]))\n        this.maxTime = Math.max(...data.map(d=>d[time]));\n        const groups = d3.nest().key(d=>d[group]).entries(data)\n        const rs = []\n        groups.forEach(g=>{\n            const key = g.key;\n            let risk = g.values.length;\n            const values = d3.nest()\n            .key(d=> +d[time])\n            .sortKeys((a,b)=>(+a)-(+b))\n            .rollup(function(v) {\n                return {\n                    event:v.filter(d=>d[event]==event_value).length,\n                    censor:v.filter(d=>d[event]==censored_value).length\n                };\n            })\n            .entries(g.values);\n            let p = 1;\n            const points = [];\n            values.forEach(d=>{\n                const time = +d.key;\n                const e = d.value.event;\n                const c = d.value.censor;\n                if(time<0) return;\n                if(e > 0){\n                    p *= (1 - e/risk)\n                    const censored = false;\n                    points.push({p, time, censored})\n                }\n                if(c > 0){\n                    const censored = true;\n                    points.push({p, time, censored})\n                }\n                risk -= (e + c);\n            })\n            rs.push({key,points})\n            \n        })\n        \n        return rs;\n        \n    }\n    \n    drawLine(viewer, points, color){\n        const line = d3.line()\n        .curve(d3.curveStepAfter)\n        .x(d=> this.xScale(d.time))\n        .y(d=> this.yScale(d.p));       \n        viewer.append(\"path\")\n            .datum(points)\n            .attr(\"class\", \"line\")\n            .style(\"stroke\", color)\n            .attr(\"d\", line);\n        \n        \n        points.forEach(point=>{\n            if(point.censored){\n                const p = [{\n                    p:point.p-0.015,\n                    time:point.time,\n                },{\n                    p:point.p+0.015,\n                    time:point.time,\n                }] \n                viewer.append(\"path\")\n                .datum(p)\n                .attr(\"class\", \"mark\")\n                .style(\"stroke\", color)\n                .attr(\"d\", line);\n            }\n        })\n        \n        \n    }\n\n    drawCensoredMark(viewer , point, color){\n\n    }\n\n    drawKMCurve(viewer, d) {\n        \n        // draw lines\n        this.drawLine(viewer, d.points, this.color(d.key))\n        // draw marks\n    }\n\n    componentDidUpdate() {\n\n    }\n    \n    componentDidMount() {\n        setTimeout(()=>{\n            const rect = this.self.current.getBoundingClientRect();\n            const innerWidth = rect.width - this.state.margin.left - this.state.margin.right;\n            const innerHeight = rect.height - this.state.margin.top - this.state.margin.bottom;\n            // create svg \n            const svg = d3.select(this.self.current)\n            .append(\"svg\")\n                .attr(\"width\", rect.width)\n                .attr(\"height\", rect.height)\n            // create viewer\n            const viewer = svg.append(\"g\")\n                .attr(\"transform\", \"translate(\" + this.state.margin.left + \",\" + this.state.margin.top + \")\");\n            //\n            this.xScale = d3.scaleLinear()\n            .domain([0, this.maxTime])\n            .range([0, innerWidth])\n            \n            this.yScale = d3.scaleLinear()\n            .domain([0, 1])\n            .range([innerHeight, 0])\n    \n            this.color = d3.scaleOrdinal()\n            .domain(this.state.data.map(d => d.key))\n            .range(d3.quantize(t => d3.interpolateSpectral(t), this.state.data.length))\n            \n            \n    \n    \n            const xaxisGroup = viewer.append(\"g\")\n            .attr(\"transform\", \"translate(0,\" + innerHeight + \")\")\n            .call(d3.axisBottom(this.xScale).ticks(4)); //.tickSize(-innerWidth));\n            xaxisGroup.append('text')\n            .attr('y', 30)\n            .attr('x', innerWidth/2)\n            .attr('fill','black')\n            .attr('font-size',13)\n            .text(`Time ${this.props.fields.time.unit?`(${this.props.fields.time.unit})`:''}`)\n            \n            // add the y Axis\n            const yaxisGroup = viewer.append(\"g\")\n                .call(d3.axisLeft(this.yScale).ticks(4)); // .tickSize(-innerWidth)\n                yaxisGroup.append('text')\n                .attr('y', -30)\n                .attr('x', -innerHeight/3)\n                .attr('fill','black')\n                .attr('font-size',13)\n                .attr(\"transform\", \"rotate(-90)\")\n                .text(`Survival Probability`)\n    \n            this.state.data.forEach(d=>this.drawKMCurve(viewer,d))\n    \n    \n            const height = 0;\n            const width = 15;\n            var nodeWidth = (d) => d.getBBox().width;\n            const legend = svg.append('g')\n              .attr('class', 'legend')\n              .attr('transform', `translate(${this.state.margin.left+innerWidth/2},0)`);\n    \n            const lg = legend.selectAll('g')\n              .data(this.state.data)\n              .enter()\n            .append('g')\n              .attr('transform', (d,i) => `translate(${i * 100},${height + 15})`);\n    \n            lg.append('rect')\n              .style('fill', d => this.color(d.key))\n              .attr('x', 0)\n              .attr('y', 0)\n              .attr('width', 10)\n              .attr('height', 10);\n    \n            lg.append('text')\n              .style('font-family', 'Georgia')\n              .style('font-size', '13px')\n              .attr('x', 17.5)\n              .attr('y', 10)\n              .text(d => d.key);\n    \n            let offset = 0;\n            lg.attr('transform', function(d, i) {\n                let x = offset;\n                offset += nodeWidth(this) + 10;\n                return `translate(${x},${height + 10})`;\n            }); \n        },500);\n       \n    }\n    \n    render() {\n        return (\n            <div\n              id={this.props.id}\n              ref={this.self}\n              style={{ width: \"100%\", height: \"100%\" }}\n            ></div>\n        );\n    }\n}\n"]}